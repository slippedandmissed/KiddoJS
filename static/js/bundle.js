(()=>{"use strict";var t,e=function(){return(e=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)},n=function(){function t(t){this.className=t}return t.prototype.serialize=function(){return this},t.prototype.deserialize=function(t){throw new Error("Abstract method must be implemented")},t}(),i=function(){function t(t){this.types={},this.types=t}return t.prototype.dfs=function(t,n){var i;for(var r in i=t instanceof Array?function(t,e){for(var n=0,i=e.length,r=t.length;n<i;n++,r++)t[r]=e[n];return t}([],t):t instanceof Object?e({},t):t,t){for(var o=!0,s=null,a=0,l=n;a<l.length;a++){var c=l[a],u=c.predicate(i[r]);if(u.satisfies){s=c,u.continue||(o=!1);break}}o&&(i[r]=this.dfs(i[r],n)),s&&(i[r]=s.replacement(i[r]))}return i},t.prototype.serialize=function(t){return JSON.stringify(t)},t.prototype.deserialize=function(t){var e=this,n=[{predicate:function(t){return{satisfies:"string"==typeof t,continue:!1}},replacement:function(t){return t}},{predicate:function(t){return{satisfies:Object.keys(e.types).includes(null==t?void 0:t.className),continue:!0}},replacement:function(t){return e.types[t.className].deserialize(t)}}];return this.dfs({object:JSON.parse(t)},n).object},t}(),r=(t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)},function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}),o=function(t){function e(e,n,i){void 0===i&&(i=null);var r=t.call(this,"Cell")||this;r.selectable=!0,r.selected=!1,r.notes=[],r.notesInnerElements={},i?i.innerHTML="":i=document.createElement("div"),r.container=i,r.container.classList.add("cell"),r.container.classList.add("selectable"),r.valueElement=document.createElement("div"),r.valueElement.classList.add("value"),r.container.appendChild(r.valueElement),r.notesElement=document.createElement("div"),r.notesElement.classList.add("notes"),r.container.appendChild(r.notesElement),r.setValue(e);for(var o=0,s=n;o<s.length;o++){var a=s[o];r.addNote(a)}return r}return r(e,t),e.deserialize=function(t){var n=new e(t.value,t.notes,document.querySelector("#c"+t.pos.x+"-"+t.pos.y));return n.selectable=t.selectable,n.setSelected(t.selected),n.pos=t.pos,n},e.prototype.getContainer=function(){return this.container},e.prototype.getValue=function(){return this.value},e.prototype.getPos=function(){return this.pos},e.prototype.setPos=function(t){this.pos=t,this.container.id="c"+t.x+"-"+t.y},e.prototype.setValue=function(t){this.value=t,this.valueElement.innerText=t},e.prototype.getNotes=function(){return Object.keys(this.notesInnerElements)},e.prototype.addNote=function(t){if(!this.hasNote(t)){this.notes.push(t);var e=document.createElement("span");e.innerText=t,e.classList.add("note-element"),this.notesInnerElements[t]=e;for(var n=!1,i=0;i<this.notesElement.children.length;i++){var r=this.notesElement.children[i];if(t<r.textContent){r.before(e),n=!0;break}}n||this.notesElement.appendChild(e)}},e.prototype.removeNote=function(t){this.hasNote(t)&&(this.notes.splice(this.notes.indexOf(t),1),this.notesInnerElements[t].remove(),delete this.notesInnerElements[t])},e.prototype.hasNote=function(t){return this.notesInnerElements.hasOwnProperty(t)},e.prototype.setNote=function(t,e){e?this.addNote(t):this.removeNote(t)},e.prototype.clearNotes=function(){for(var t=0,e=this.getNotes();t<e.length;t++){var n=e[t];this.notesInnerElements[n].remove(),delete this.notesInnerElements[n],this.notes.length=0}},e.prototype.isSelectable=function(){return this.selectable},e.prototype.setSelectable=function(t){this.selectable=t,this.container.classList[t?"add":"remove"]("selectable")},e.prototype.isSelected=function(){return this.selected},e.prototype.setSelected=function(t){this.selectable&&(this.selected=t,this.container.classList[t?"add":"remove"]("selected"))},e}(n),s=function(t){function e(e,n){void 0===n&&(n=null);var i=t.call(this,e,[],n)||this;return i.className="GivenCell",i.setSelectable(!1),i.getContainer().classList.add("given"),i}return r(e,t),e.deserialize=function(t){var n=new e(t.value,document.querySelector("#c"+t.pos.x+"-"+t.pos.y));return n.setPos(t.pos),n},e}(o),a=function(){function t(t){void 0===t&&(t=1/0),this.states=[],this.pointer=-1,this.maxSize=t}return t.prototype.push=function(t){return(0===this.states.length||this.states[this.pointer]!==t)&&(this.pointer++,this.pointer<this.states.length&&this.states.splice(this.pointer),this.pointer>this.maxSize&&(this.pointer--,this.states.splice(0,1)),this.states.push(t),!0)},t.prototype.undo=function(){return this.pointer>0&&this.pointer--,this.pointer<this.states.length?this.states[this.pointer]:null},t.prototype.redo=function(){return this.pointer<this.states.length-1?(this.pointer++,this.states[this.pointer]):null},t}(),l=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),c=function(t){function e(e){return t.call(this,e)||this}return l(e,t),e.prototype.getContainer=function(){throw new Error("Unimplemented method")},e.prototype.initializeContainer=function(){throw new Error("Unimplemented method")},e}(n),u=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),h=function(t){function e(e,n,i){void 0===i&&(i=null);var r=t.call(this,"Box")||this;return r.topLeft=e,r.size=n,r.container=i,r}return u(e,t),e.deserialize=function(t){return new e(t.topLeft,t.size,document.querySelector(".b"+t.topLeft.x+"-"+t.topLeft.y+"-"+t.size.width+"-"+t.size.height))},e.prototype.getTopLeft=function(){return this.topLeft},e.prototype.getSize=function(){return this.size},e.prototype.getContainer=function(){return this.container},e.prototype.initializeContainer=function(){this.container?this.container.innerHTML="":this.container=document.createElement("div"),this.container.className="box middleware",this.container.classList.add("b"+this.topLeft.x+"-"+this.topLeft.y+"-"+this.size.width+"-"+this.size.height),this.container.style.gridColumnStart=""+(this.topLeft.x+1),this.container.style.gridColumnEnd=""+(this.topLeft.x+this.size.width+1),this.container.style.gridRowStart=""+(this.topLeft.y+1),this.container.style.gridRowEnd=""+(this.topLeft.y+this.size.height+1)},e}(c),p=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),d=function(t){function e(e,n,i){void 0===i&&(i=null);var r=t.call(this,"Sudoku")||this;r.constraints=[],r.grid=e,r.size={width:e[0].length,height:e.length},i||(i=document.createElement("div")),r.container=i,r.container.classList.add("sudoku"),r.initializeGrid();for(var o=0,s=n;o<s.length;o++){var a=s[o];r.addConstraint(a)}return r}return p(e,t),e.deserialize=function(t){return new e(t.grid,t.constraints,document.querySelector(".sudoku"))},e.prototype.initializeGrid=function(){this.container.innerHTML="";for(var t=0;t<this.size.height;t++)for(var e=0;e<this.size.width;e++){var n=this.grid[t][e].getContainer();n.style.gridColumnStart=""+(e+1),n.style.gridRowStart=""+(t+1),this.container.appendChild(n)}},e.prototype.addConstraint=function(t){this.constraints.push(t),t.initializeContainer(),this.container.appendChild(t.getContainer())},e.CreateStandard=function(t,n){void 0===t&&(t=3),void 0===n&&(n=3);for(var i=[],r=[],s=t*n,a=0;a<t;a++)for(var l=0;l<t;l++)r.push(new h({x:a*n,y:l*n},{width:n,height:n}));for(var c=0;c<s;c++){i[c]=[];for(var u=0;u<s;u++){var p=new o(null,[]);p.setPos({x:u,y:c}),i[c].push(p)}}return new e(i,r)},e.prototype.getContainer=function(){return this.container},e.prototype.setCell=function(t,e){this.grid[t.y][t.x].getContainer().remove(),delete this.grid[t.y][t.x],e.setPos(t),this.grid[t.y][t.x]=e;var n=e.getContainer();n.style.gridColumnStart=""+(t.x+1),n.style.gridRowStart=""+(t.y+1),this.container.appendChild(n)},e.prototype.getCell=function(t){return this.grid[t.y][t.x]},e}(n),f=function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(e,n)};return function(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}}(),y=function(t){function e(e,n){void 0===n&&(n=null);var i=t.call(this,"Thermometer")||this;i.coords=e,i.container=n;for(var r=1/0,o=1/0,s=-1/0,a=-1/0,l=0,c=e;l<c.length;l++)(p=c[l]).x<o&&(o=p.x),p.x>a&&(a=p.x),p.y<r&&(r=p.y),p.y>s&&(s=p.y);i.topLeft={x:o,y:r},i.size={width:a-o+1,height:s-r+1},i.relativeCoords=[];for(var u=0,h=e;u<h.length;u++){var p=h[u];i.relativeCoords.push({x:p.x-o,y:p.y-r})}return i}return f(e,t),e.deserialize=function(t){return new e(t.coords,document.querySelector(e.generateID.bind(t)()))},e.prototype.getContainer=function(){return this.container},e.generateID=function(){for(var t="th",e=0,n=this.coords;e<n.length;e++){var i=n[e];t+=i.x+"-"+i.y+"-"}return t.slice(0,-1)},e.prototype.initializeContainer=function(){var t=this;this.container?this.container.innerHTML="":this.container=document.createElement("div"),this.container.className="thermometer middleware",this.container.classList.add(e.generateID.bind(this)()),this.container.style.gridColumnStart=""+(this.topLeft.x+1),this.container.style.gridColumnEnd=""+(this.topLeft.x+this.size.width+1),this.container.style.gridRowStart=""+(this.topLeft.y+1),this.container.style.gridRowEnd=""+(this.topLeft.y+this.size.height+1);for(var n=function(){var e=m("circle");return e.setAttribute("cx",""+(t.relativeCoords[0].x+.5)),e.setAttribute("cy",""+(t.relativeCoords[0].y+.5)),e.setAttribute("r","0.42"),e},i="mask"+w();document.getElementById(i);)i="mask"+w();var r=m("svg");r.setAttribute("viewBox","0 0 "+this.size.width+" "+this.size.height),r.setAttribute("preserveAspectRatio","none");var o=m("polyline");r.appendChild(o);var s=m("defs"),a=m("mask");a.setAttribute("id",i),s.appendChild(a);var l=m("rect");l.setAttribute("x","0"),l.setAttribute("y","0"),l.setAttribute("width",""+this.size.width),l.setAttribute("height",""+this.size.height),l.setAttribute("stroke","none"),l.setAttribute("fill","white"),a.appendChild(l);var c=m("polyline");c.classList.add("inner"),c.setAttribute("stroke","black"),a.appendChild(c);var u=n();u.classList.add("mask"),a.appendChild(u),r.appendChild(s);for(var h=[],p=0,d=this.relativeCoords;p<d.length;p++){var f=d[p];h.push(f.x+.5+","+(f.y+.5))}o.setAttribute("mask","url(#"+i+")"),o.setAttribute("points",h.join(" ")),c.setAttribute("points",h.join(" ")),r.appendChild(n()),this.container.appendChild(r)},e}(c),v=["1","2","3","4","5","6","7","8","9"],g={Sudoku:d,Cell:o,GivenCell:s,Box:h,Thermometer:y};function m(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function w(t){void 0===t&&(t=10);for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",i=0;i<t;i++)n+=e.charAt(Math.floor(Math.random()*e.length));return n}var C=function(){function t(t,e,n,r){void 0===n&&(n=v),void 0===r&&(r=null),this.selected=[],this.title=t,this.sudoku=e,this.alphabet=n,r||(r=new i(g)),this.serializer=r,this.historyStack=new a,this.pushState(),this.getSudokuElement().addEventListener("click",this.onClick.bind(this)),document.addEventListener("keydown",this.onKeyDown.bind(this))}return t.prototype.pushState=function(){var t=this.serializer.serialize(this.sudoku);this.historyStack.push(t)},t.prototype.loadState=function(t){var e=this;t&&(this.sudoku=this.serializer.deserialize(t),this.selected=[],document.querySelectorAll(".cell.selected").forEach((function(t){var n=t.id.slice(1).split("-"),i={x:+n[0],y:+n[1]};e.selected.push(e.sudoku.getCell(i))})))},t.prototype.onClick=function(t){var e=t.target,n=function(t,e){for(var n=0,i=e.length,r=t.length;n<i;n++,r++)t[r]=e[n];return t}([],this.selected);if(!t.shiftKey){for(var i=0,r=this.selected;i<r.length;i++)(o=r[i]).setSelected(!1);this.selected.length=0}if(e.classList.contains("cell")){var o,s=e.id.slice(1).split("-"),a={x:+s[0],y:+s[1]};if((o=this.sudoku.getCell(a)).setSelected(!n.includes(o)||n.length>1),o.isSelected())this.selected.push(o);else{var l=this.selected.indexOf(o);l>=0&&this.selected.splice(l,1)}}this.pushState()},t.prototype.onKeyDown=function(t){var e=String.fromCharCode(t.keyCode).toUpperCase();if(t.ctrlKey)"Z"===e&&this.loadState(this.historyStack.undo()),"Y"===e&&this.loadState(this.historyStack.redo());else if(this.alphabet.includes(e)){if(t.shiftKey){for(var n=!0,i=0,r=this.selected;i<r.length;i++)if(!r[i].hasNote(e)){n=!1;break}for(var o=0,s=this.selected;o<s.length;o++)s[o].setNote(e,!n)}else for(var a=0,l=this.selected;a<l.length;a++)l[a].setValue(e);this.pushState()}else if("Backspace"===t.key){if(t.shiftKey)for(var c=0,u=this.selected;c<u.length;c++)u[c].clearNotes();else for(var h=0,p=this.selected;h<p.length;h++)p[h].setValue(null);this.pushState()}},t.prototype.getTitle=function(){return this.title},t.prototype.setTitle=function(t){this.title=t},t.prototype.getSudoku=function(){return this.sudoku},t.prototype.getSudokuElement=function(){return this.sudoku.getContainer()},t}(),b=d.CreateStandard();b.setCell({x:2,y:3},new s("5")),b.addConstraint(new y([{x:2,y:2},{x:3,y:3},{x:4,y:2},{x:4,y:1},{x:3,y:0}])),b.addConstraint(new y([{x:2,y:2},{x:1,y:2}]));var S=new C("My Sudoku",b);window.onload=function(){document.body.appendChild(S.getSudokuElement())}})();